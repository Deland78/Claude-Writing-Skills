============================= test session starts =============================
platform win32 -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0 -- C:\Python313\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\david\OneDrive\G-drive\K-D\Claude-Writing-Skills
configfile: pyproject.toml
plugins: anyio-4.10.0, langsmith-0.4.49, base-url-2.1.0, playwright-0.7.2, timeout-2.4.0, asyncio-1.2.0, cov-7.0.0, mock-3.15.1
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 241 items

tests/test_act_outline_skill.py::test_skill_file_exists PASSED           [  0%]
tests/test_act_outline_skill.py::test_skill_has_yaml_frontmatter PASSED  [  0%]
tests/test_act_outline_skill.py::test_skill_references_template PASSED   [  1%]
tests/test_act_outline_skill.py::test_skill_documents_state_update PASSED [  1%]
tests/test_act_outline_skill.py::test_skill_requires_arc_file PASSED     [  2%]
tests/test_act_outline_skill.py::test_valid_outline_input_passes_schema PASSED [  2%]
tests/test_act_outline_skill.py::test_outline_input_missing_act_number_fails PASSED [  2%]
tests/test_act_outline_skill.py::test_outline_input_act_number_zero_fails PASSED [  3%]
tests/test_act_outline_skill.py::test_outline_input_missing_arc_file_fails PASSED [  3%]
tests/test_act_outline_skill.py::test_template_exists PASSED             [  4%]
tests/test_act_outline_skill.py::test_golden_example_conforms_to_template PASSED [  4%]
tests/test_act_outline_skill.py::test_golden_example_has_no_placeholder_comments PASSED [  4%]
tests/test_act_outline_skill.py::test_output_path_pattern_is_correct PASSED [  5%]
tests/test_agents.py::test_agents_directory_exists PASSED                [  5%]
tests/test_agents.py::test_agent_file_exists[lead-editor] PASSED         [  6%]
tests/test_agents.py::test_agent_file_exists[plot-analyst] PASSED        [  6%]
tests/test_agents.py::test_agent_file_exists[character-specialist] PASSED [  7%]
tests/test_agents.py::test_agent_file_exists[depth-partner] PASSED       [  7%]
tests/test_agents.py::test_agent_file_exists[continuity-agent] PASSED    [  7%]
tests/test_agents.py::test_agent_file_exists[prose-crafter] PASSED       [  8%]
tests/test_agents.py::test_specialist_has_required_sections[plot-analyst] PASSED [  8%]
tests/test_agents.py::test_specialist_has_required_sections[character-specialist] PASSED [  9%]
tests/test_agents.py::test_specialist_has_required_sections[depth-partner] PASSED [  9%]
tests/test_agents.py::test_specialist_has_required_sections[continuity-agent] PASSED [  9%]
tests/test_agents.py::test_specialist_has_required_sections[prose-crafter] PASSED [ 10%]
tests/test_agents.py::test_agent_has_role_section[lead-editor] PASSED    [ 10%]
tests/test_agents.py::test_agent_has_role_section[plot-analyst] PASSED   [ 11%]
tests/test_agents.py::test_agent_has_role_section[character-specialist] PASSED [ 11%]
tests/test_agents.py::test_agent_has_role_section[depth-partner] PASSED  [ 12%]
tests/test_agents.py::test_agent_has_role_section[continuity-agent] PASSED [ 12%]
tests/test_agents.py::test_agent_has_role_section[prose-crafter] PASSED  [ 12%]
tests/test_agents.py::test_agent_has_prompt_section[lead-editor] PASSED  [ 13%]
tests/test_agents.py::test_agent_has_prompt_section[plot-analyst] PASSED [ 13%]
tests/test_agents.py::test_agent_has_prompt_section[character-specialist] PASSED [ 14%]
tests/test_agents.py::test_agent_has_prompt_section[depth-partner] PASSED [ 14%]
tests/test_agents.py::test_agent_has_prompt_section[continuity-agent] PASSED [ 14%]
tests/test_agents.py::test_agent_has_prompt_section[prose-crafter] PASSED [ 15%]
tests/test_agents.py::test_prose_crafter_restricted_to_l4_l5 PASSED      [ 15%]
tests/test_agents.py::test_continuity_agent_restricted_to_l3_plus PASSED [ 16%]
tests/test_agents.py::test_depth_partner_restricted_to_l1_l3 PASSED      [ 16%]
tests/test_agents.py::test_lead_editor_has_protocol_reference PASSED     [ 17%]
tests/test_agents.py::test_lead_editor_has_governance_section PASSED     [ 17%]
tests/test_agents.py::test_specialist_references_canon_citation[plot-analyst] PASSED [ 17%]
tests/test_agents.py::test_specialist_references_canon_citation[character-specialist] PASSED [ 18%]
tests/test_agents.py::test_specialist_references_canon_citation[depth-partner] PASSED [ 18%]
tests/test_agents.py::test_specialist_references_canon_citation[continuity-agent] PASSED [ 19%]
tests/test_agents.py::test_specialist_references_canon_citation[prose-crafter] PASSED [ 19%]
tests/test_agents.py::test_specialist_mentions_advisory[plot-analyst] PASSED [ 19%]
tests/test_agents.py::test_specialist_mentions_advisory[character-specialist] PASSED [ 20%]
tests/test_agents.py::test_specialist_mentions_advisory[depth-partner] PASSED [ 20%]
tests/test_agents.py::test_specialist_mentions_advisory[continuity-agent] PASSED [ 21%]
tests/test_agents.py::test_specialist_mentions_advisory[prose-crafter] PASSED [ 21%]
tests/test_agents.py::test_agent_contract_doc_exists PASSED              [ 21%]
tests/test_agents.py::test_agent_contract_has_citation_rule PASSED       [ 22%]
tests/test_agents.py::test_agent_contract_has_role_boundaries PASSED     [ 22%]
tests/test_context_loader.py::test_l1_concept_loads_system_files_only PASSED [ 23%]
tests/test_context_loader.py::test_l2_loads_system_plus_concept PASSED   [ 23%]
tests/test_context_loader.py::test_l3_act2_loads_parent_chain_plus_sibling PASSED [ 24%]
tests/test_context_loader.py::test_l3_does_not_load_chapter_outlines PASSED [ 24%]
tests/test_context_loader.py::test_l4_loads_chapter_outlines_and_characters PASSED [ 24%]
tests/test_context_loader.py::test_l4_does_not_load_scene_drafts PASSED  [ 25%]
tests/test_context_loader.py::test_l5_scene_loads_chapter_outline_and_characters PASSED [ 25%]
tests/test_context_loader.py::test_l5_does_not_load_sibling_scenes PASSED [ 26%]
tests/test_context_loader.py::test_manifest_hash_is_deterministic PASSED [ 26%]
tests/test_context_loader.py::test_manifest_includes_token_estimate PASSED [ 26%]
tests/test_context_loader.py::test_reproducibility_bundle_includes_all_fields PASSED [ 27%]
tests/test_context_loader.py::test_manifest_handles_missing_files_gracefully PASSED [ 27%]
tests/test_context_loader.py::test_manifest_no_duplicates PASSED         [ 28%]
tests/test_context_loader.py::test_different_levels_produce_different_hashes PASSED [ 28%]
tests/test_governance.py::test_citation_enforcement_doc_exists PASSED    [ 29%]
tests/test_governance.py::test_citation_enforcement_doc_has_cited_rule PASSED [ 29%]
tests/test_governance.py::test_citation_enforcement_doc_has_advisory_rule PASSED [ 29%]
tests/test_governance.py::test_citation_enforcement_doc_has_override_rule PASSED [ 30%]
tests/test_governance.py::test_citation_enforcement_doc_references_schema PASSED [ 30%]
tests/test_governance.py::test_citation_enforcement_doc_references_mob_protocol PASSED [ 31%]
tests/test_governance.py::test_citation_status_cited_passes PASSED       [ 31%]
tests/test_governance.py::test_citation_status_advisory_passes PASSED    [ 31%]
tests/test_governance.py::test_citation_status_invalid_value_fails PASSED [ 32%]
tests/test_governance.py::test_citation_status_is_optional PASSED        [ 32%]
tests/test_governance.py::test_cited_with_empty_citations_is_logically_inconsistent PASSED [ 33%]
tests/test_governance.py::test_pipeline_state_mob_config_validates PASSED [ 33%]
tests/test_governance.py::test_pipeline_state_mob_config_max_rounds_minimum PASSED [ 34%]
tests/test_governance.py::test_pipeline_state_mob_config_budget_cap_non_negative PASSED [ 34%]
tests/test_governance.py::test_live_pipeline_state_has_mob_config PASSED [ 34%]
tests/test_governance.py::test_lead_editor_references_citation_enforcement PASSED [ 35%]
tests/test_governance.py::test_lead_editor_references_round_limit PASSED [ 35%]
tests/test_governance.py::test_lead_editor_references_diminishing_returns PASSED [ 36%]
tests/test_governance.py::test_mob_protocol_has_governance_checks PASSED [ 36%]
tests/test_governance.py::test_mob_protocol_references_citation_enforcement PASSED [ 36%]
tests/test_governance.py::test_mob_protocol_has_termination_rules PASSED [ 37%]
tests/test_migration.py::test_dry_run_produces_mapping_report PASSED     [ 37%]
tests/test_migration.py::test_dry_run_does_not_modify_files PASSED       [ 38%]
tests/test_migration.py::test_execute_moves_files PASSED                 [ 38%]
tests/test_migration.py::test_execute_merges_scene_tracker PASSED        [ 39%]
tests/test_migration.py::test_execute_deletes_entity_matrix PASSED       [ 39%]
tests/test_migration.py::test_execute_deletes_world_readme PASSED        [ 39%]
tests/test_migration.py::test_execute_updates_skill_refs PASSED          [ 40%]
tests/test_migration.py::test_execute_updates_claude_md PASSED           [ 40%]
tests/test_migration.py::test_execute_creates_rollback_manifest PASSED   [ 41%]
tests/test_migration.py::test_rollback_reverts PASSED                    [ 41%]
tests/test_migration.py::test_verify_passes_after_execute PASSED         [ 41%]
tests/test_migration.py::test_verify_catches_broken_refs PASSED          [ 42%]
tests/test_migration.py::test_verify_scans_entire_repo PASSED            [ 42%]
tests/test_migration.py::test_verify_produces_report_with_counts PASSED  [ 43%]
tests/test_mob_protocol.py::test_mob_session_skill_exists PASSED         [ 43%]
tests/test_mob_protocol.py::test_mob_session_skill_has_yaml_frontmatter PASSED [ 43%]
tests/test_mob_protocol.py::test_mob_session_skill_name PASSED           [ 44%]
tests/test_mob_protocol.py::test_skill_references_agents_directory PASSED [ 44%]
tests/test_mob_protocol.py::test_skill_documents_all_four_phases PASSED  [ 45%]
tests/test_mob_protocol.py::test_skill_includes_role_switch_separator PASSED [ 45%]
tests/test_mob_protocol.py::test_skill_references_context_loader PASSED  [ 46%]
tests/test_mob_protocol.py::test_skill_references_governance PASSED      [ 46%]
tests/test_mob_protocol.py::test_skill_references_citation_enforcement PASSED [ 46%]
tests/test_mob_protocol.py::test_skill_references_trace_renderer PASSED  [ 47%]
tests/test_mob_protocol.py::test_skill_documents_agent_activation_table PASSED [ 47%]
tests/test_mob_protocol.py::test_protocol_doc_exists PASSED              [ 48%]
tests/test_mob_protocol.py::test_protocol_doc_has_four_phases PASSED     [ 48%]
tests/test_mob_protocol.py::test_protocol_doc_has_turn_order PASSED      [ 48%]
tests/test_mob_protocol.py::test_protocol_doc_has_governance_section PASSED [ 49%]
tests/test_mob_protocol.py::test_protocol_doc_references_citation_enforcement PASSED [ 49%]
tests/test_mob_protocol.py::test_protocol_doc_has_role_switch_convention PASSED [ 50%]
tests/test_no_bible_refs.py::test_no_bible_references_in_skills PASSED   [ 50%]
tests/test_no_bible_refs.py::test_no_bible_references_in_claude_md PASSED [ 51%]
tests/test_no_bible_refs.py::test_no_bible_references_in_docs PASSED     [ 51%]
tests/test_no_bible_refs.py::test_no_bible_references_in_canon PASSED    [ 51%]
tests/test_no_bible_refs.py::test_no_bible_references_in_templates PASSED [ 52%]
tests/test_relationships.py::test_query_by_entity_returns_all_aliases PASSED [ 52%]
tests/test_relationships.py::test_query_by_alias_string PASSED           [ 53%]
tests/test_relationships.py::test_add_rejects_unknown_rel_vocabulary PASSED [ 53%]
tests/test_relationships.py::test_add_valid_relationship PASSED          [ 53%]
tests/test_relationships.py::test_add_generates_sequential_ids PASSED    [ 54%]
tests/test_relationships.py::test_render_matrix_produces_markdown PASSED [ 54%]
tests/test_relationships.py::test_render_matrix_empty_entities PASSED    [ 55%]
tests/test_relationships.py::test_query_as_of_filters_temporally PASSED  [ 55%]
tests/test_relationships.py::test_query_as_of_handles_double_digit_chapters PASSED [ 56%]
tests/test_relationships.py::test_parse_position_act_ch PASSED           [ 56%]
tests/test_relationships.py::test_parse_position_l_format PASSED         [ 56%]
tests/test_relationships.py::test_parse_position_invalid_raises PASSED   [ 57%]
tests/test_relationships.py::test_query_as_of_excludes_expired PASSED    [ 57%]
tests/test_relationships.py::test_query_as_of_includes_not_yet_expired PASSED [ 58%]
tests/test_relationships.py::test_validate_catches_broken_supersession PASSED [ 58%]
tests/test_relationships.py::test_validate_catches_circular_supersession PASSED [ 58%]
tests/test_relationships.py::test_validate_catches_duplicate_relationship_ids PASSED [ 59%]
tests/test_relationships.py::test_validate_catches_alias_collision PASSED [ 59%]
tests/test_relationships.py::test_validate_catches_temporal_overlap PASSED [ 60%]
tests/test_relationships.py::test_validate_checks_source_citation_format PASSED [ 60%]
tests/test_relationships.py::test_validate_passes_clean_data PASSED      [ 60%]
tests/test_relationships.py::test_validate_cli_valid PASSED              [ 61%]
tests/test_relationships.py::test_validate_cli_invalid PASSED            [ 61%]
tests/test_relationships.py::test_query_cli PASSED                       [ 62%]
tests/test_relationships.py::test_render_matrix_cli PASSED               [ 62%]
tests/test_schemas.py::test_valid_agent_comment_passes PASSED            [ 63%]
tests/test_schemas.py::test_agent_comment_missing_citations_fails PASSED [ 63%]
tests/test_schemas.py::test_agent_comment_missing_model_fails PASSED     [ 63%]
tests/test_schemas.py::test_agent_comment_empty_comment_fails PASSED     [ 64%]
tests/test_schemas.py::test_agent_comment_valid_resolution_values PASSED [ 64%]
tests/test_schemas.py::test_agent_comment_invalid_resolution_fails PASSED [ 65%]
tests/test_schemas.py::test_agent_comment_citation_status_cited_passes PASSED [ 65%]
tests/test_schemas.py::test_agent_comment_citation_status_advisory_passes PASSED [ 65%]
tests/test_schemas.py::test_agent_comment_citation_status_invalid_fails PASSED [ 66%]
tests/test_schemas.py::test_valid_commit_patch_requires_citation PASSED  [ 66%]
tests/test_schemas.py::test_valid_commit_patch_passes PASSED             [ 67%]
tests/test_schemas.py::test_commit_patch_invalid_action_fails PASSED     [ 67%]
tests/test_schemas.py::test_relationship_entry_bad_vocabulary_fails PASSED [ 68%]
tests/test_schemas.py::test_valid_relationships_passes PASSED            [ 68%]
tests/test_schemas.py::test_relationships_missing_entities_fails PASSED  [ 68%]
tests/test_schemas.py::test_valid_pipeline_state_passes PASSED           [ 69%]
tests/test_schemas.py::test_pipeline_state_missing_position_fails PASSED [ 69%]
tests/test_schemas.py::test_pipeline_state_invalid_level_fails PASSED    [ 70%]
tests/test_schemas.py::test_valid_node_input_passes PASSED               [ 70%]
tests/test_schemas.py::test_node_input_empty_context_files_fails PASSED  [ 70%]
tests/test_schemas.py::test_all_schemas_are_valid PASSED                 [ 71%]
tests/test_schemas.py::test_validate_file_valid_example PASSED           [ 71%]
tests/test_schemas.py::test_validate_file_bad_example PASSED             [ 72%]
tests/test_schemas.py::test_valid_story_concept_input_passes PASSED      [ 72%]
tests/test_schemas.py::test_story_concept_input_with_optionals_passes PASSED [ 73%]
tests/test_schemas.py::test_story_concept_input_missing_genre_fails PASSED [ 73%]
tests/test_schemas.py::test_story_concept_input_missing_protagonist_fails PASSED [ 73%]
tests/test_schemas.py::test_story_concept_input_empty_genre_fails PASSED [ 74%]
tests/test_schemas.py::test_story_concept_input_extra_field_fails PASSED [ 74%]
tests/test_schemas.py::test_valid_story_arc_input_passes PASSED          [ 75%]
tests/test_schemas.py::test_story_arc_input_with_optionals_passes PASSED [ 75%]
tests/test_schemas.py::test_story_arc_input_missing_concept_file_fails PASSED [ 75%]
tests/test_schemas.py::test_story_arc_input_act_count_below_minimum_fails PASSED [ 76%]
tests/test_schemas.py::test_valid_act_outline_input_passes PASSED        [ 76%]
tests/test_schemas.py::test_act_outline_input_with_hint_passes PASSED    [ 77%]
tests/test_schemas.py::test_act_outline_input_missing_act_number_fails PASSED [ 77%]
tests/test_schemas.py::test_act_outline_input_act_number_zero_fails PASSED [ 78%]
tests/test_schemas.py::test_act_outline_input_missing_arc_file_fails PASSED [ 78%]
tests/test_schemas.py::test_validate_file_valid_concept_input PASSED     [ 78%]
tests/test_schemas.py::test_validate_file_valid_arc_input PASSED         [ 79%]
tests/test_schemas.py::test_validate_file_valid_outline_input PASSED     [ 79%]
tests/test_skill_concept.py::test_skill_file_exists PASSED               [ 80%]
tests/test_skill_concept.py::test_skill_has_yaml_frontmatter PASSED      [ 80%]
tests/test_skill_concept.py::test_skill_references_template PASSED       [ 80%]
tests/test_skill_concept.py::test_skill_documents_state_update PASSED    [ 81%]
tests/test_skill_concept.py::test_skill_references_story_promise PASSED  [ 81%]
tests/test_skill_concept.py::test_valid_concept_input_passes_schema PASSED [ 82%]
tests/test_skill_concept.py::test_concept_input_missing_required_field_fails PASSED [ 82%]
tests/test_skill_concept.py::test_template_exists PASSED                 [ 82%]
tests/test_skill_concept.py::test_golden_example_conforms_to_template PASSED [ 83%]
tests/test_skill_concept.py::test_golden_example_has_no_placeholder_comments PASSED [ 83%]
tests/test_skill_concept.py::test_output_path_is_correct PASSED          [ 84%]
tests/test_story_arc_builder.py::test_skill_file_exists PASSED           [ 84%]
tests/test_story_arc_builder.py::test_skill_has_yaml_frontmatter PASSED  [ 85%]
tests/test_story_arc_builder.py::test_skill_references_template PASSED   [ 85%]
tests/test_story_arc_builder.py::test_skill_documents_state_update PASSED [ 85%]
tests/test_story_arc_builder.py::test_skill_requires_concept_file PASSED [ 86%]
tests/test_story_arc_builder.py::test_valid_arc_input_passes_schema PASSED [ 86%]
tests/test_story_arc_builder.py::test_arc_input_missing_concept_file_fails PASSED [ 87%]
tests/test_story_arc_builder.py::test_arc_input_invalid_act_count_fails PASSED [ 87%]
tests/test_story_arc_builder.py::test_template_exists PASSED             [ 87%]
tests/test_story_arc_builder.py::test_golden_example_conforms_to_template PASSED [ 88%]
tests/test_story_arc_builder.py::test_golden_example_has_no_placeholder_comments PASSED [ 88%]
tests/test_story_arc_builder.py::test_output_path_is_correct PASSED      [ 89%]
tests/test_templates.py::test_story_concept_template_exists PASSED       [ 89%]
tests/test_templates.py::test_story_arc_template_exists PASSED           [ 90%]
tests/test_templates.py::test_act_outline_template_exists PASSED         [ 90%]
tests/test_templates.py::test_story_concept_template_has_required_headings PASSED [ 90%]
tests/test_templates.py::test_story_arc_template_has_required_headings PASSED [ 91%]
tests/test_templates.py::test_act_outline_template_has_required_headings PASSED [ 91%]
tests/test_templates.py::test_all_templates_have_level1_heading PASSED   [ 92%]
tests/test_templates.py::test_all_templates_use_comment_placeholders PASSED [ 92%]
tests/test_templates.py::test_l1_golden_example_exists PASSED            [ 92%]
tests/test_templates.py::test_l2_golden_example_exists PASSED            [ 93%]
tests/test_templates.py::test_l3_golden_example_exists PASSED            [ 93%]
tests/test_templates.py::test_l1_golden_example_has_required_headings PASSED [ 94%]
tests/test_templates.py::test_l2_golden_example_has_required_headings PASSED [ 94%]
tests/test_templates.py::test_l3_golden_example_has_required_headings PASSED [ 95%]
tests/test_templates.py::test_golden_examples_are_nonempty PASSED        [ 95%]
tests/test_trace_renderer.py::test_minimal_trace_renders_without_error PASSED [ 95%]
tests/test_trace_renderer.py::test_full_trace_has_required_headings PASSED [ 96%]
tests/test_trace_renderer.py::test_full_trace_contains_agent_comments PASSED [ 96%]
tests/test_trace_renderer.py::test_full_trace_contains_resolution PASSED [ 97%]
tests/test_trace_renderer.py::test_full_trace_contains_cost_table PASSED [ 97%]
tests/test_trace_renderer.py::test_full_trace_contains_reproducibility PASSED [ 97%]
tests/test_trace_renderer.py::test_full_trace_contains_human_eval_placeholder PASSED [ 98%]
tests/test_trace_renderer.py::test_context_loaded_lists_files PASSED     [ 98%]
tests/test_trace_renderer.py::test_render_file_writes_output PASSED      [ 99%]
tests/test_trace_renderer.py::test_render_file_custom_output PASSED      [ 99%]
tests/test_trace_renderer.py::test_trace_template_exists PASSED          [100%]

============================= 241 passed in 3.75s =============================
